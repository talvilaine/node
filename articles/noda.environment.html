<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Настройка окружения</title>
</head>
<body>
<h1><span style="color: #655eeb;">PhpStorm</span></h1>

<h2>Фикс горячих клавиш в русской раскладке (<a href="https://phptime.ru/Adik88/ubuntu-1404-phpstorm-i-staryy-bag-goryachih-klavish.html">Сорс</a>)</h2>

<ul><li>Клонируем реп в $path (/home/lain/Soft/LinuxJavaFixes/).</li>
    <li>В vm конфиг приложения (например для PhpStorm — /home/lain/Soft/PhpStorm-141.2462/bin/phpstorm.vmoptions или /home/lain/Soft/PhpStorm-141.2462/bin/phpstorm64.vmoptions) дописываем ($path надо заменить на путь до патча)<br>
        <pre class="toolbar:1 trim-whitespace:false lang:java decode:true">-javaagent:$path/build/LinuxJavaFixes-1.0.0-SNAPSHOT.jar</pre></li>
    <li>Перезапускаем IDE.</li></ul>

<a href="http://tuovi.ru/images/8aa5e26e82.jpg"><img src="http://tuovi.ru/images/8aa5e26e82.jpg" alt="8aa5e26e82" width="700" height="300" class="alignnone size-full wp-image-361" /></a>

Для инспекций поставить плагин Php inspections (EA Extended)
<a href="http://tuovi.ru/images/a7d8132121.jpg"><img src="http://tuovi.ru/images/a7d8132121.jpg" alt="a7d8132121" width="700" height="300" class="alignnone size-full wp-image-270" /></a>
[13:01:09] ns: Антон Кочнев: из репозитория и надо ставить

[14:54:52] ns: Антон Кочнев: я доработал правила инспекций упростил проверку и подогнал под наши стандарты. файлик можно скачать здесь:
smb://f02/public/flkTeam/inspection.xml
инспекция при перезагрузке сама включится
(импортировать в шторм Editor-&gt;Inspections-&gt;Import(в 9 версии стало Manage-&gt;Import))
<a href="http://tuovi.ru/images/2f84c9f229.jpg"><img class="alignnone size-full wp-image-253" src="http://tuovi.ru/images/2f84c9f229.jpg" alt="2f84c9f229" width="700" height="300" /></a>
<s>Для форматирования кода желательно использовать схему smb://f02/public/flkTeam/codestyle.xml
    (положить в /home/lain/.WebIde80/config/codestyles, в шторме Editor-&gt;"Code style"-&gt;PHP-&gt;Scheme выбрать NSCodeFormat из списка)</s>
Теперь юзаем дефолтное форматирование: (<a href="http://root.abcp.ru/?page=news_cp&action=view&newsId=944">новость "Новый код стандарт."</a>)
<strong>Editor->Code Style->PHP</strong>->нажать Set from и в выпадающем списке выбрать <strong>Predefined Style->PSR1/PSR2</strong>

Плагин для подсказки горячих клавиш в шторме
Key promoter <a href="https://plugins.jetbrains.com/plugin/1003?pr=idea">https://plugins.jetbrains.com/plugin/1003?pr=idea</a>
Горячие клавиши <a href="https://www.jetbrains.com/phpstorm/documentation/PhpStorm_ReferenceCard.pdf">https://www.jetbrains.com/phpstorm/documentation/PhpStorm_ReferenceCard.pdf</a>
Темы <a href="http://ideacolorthemes.org/home/">http://ideacolorthemes.org/home/</a>
А также плагин Upsource Integration


<h1><span style="color: #655eeb;">Vde (заменен докером)</span></h1>
чтобы не переустанавливать vde можно запустить
<code>bash <(wget -q -O - http://gitlab.nodasoft.com/development/vde-router/raw/master/install-hooks.sh)</code>
но провизию всё равно было бы неплохо сделать (она сносит весь софт в контейнере и переустанавливает его в соответствии с конфигом)
<code>vde provision 12</code>
<code>vde provision 14</code>

Поднять 14 vde
<code>cd /opt/projects/abcp/vde/14.04 && vagrant up --provider=lsc</code>

<code>cd /opt/projects/abcp/vde/12.04 && vagrant ssh</code>
<code>vagrant global-status</code>

<code>cd /opt/projects/abcp/vde/12.04</code>
<code>vagrant destroy</code>
<code>vagrant up --provider=lxc</code>

Установка гнумерика (ssconvert)
<code>vde ssh 12</code>
<code>sudo apt-get install gnumeric</code>

<h1><span style="color: #655eeb;">Docker</span></h1>
<cite>
    [11:08:21] ns: Антон Кочнев: новый контроллер будет только на докере корректно работать
    [11:08:35] ns: Антон Кочнев: через nginx как и на продакшене
    [11:08:45] ns: Руслан Левицкий: (facepalm)
    [11:08:48] ns: Артём Солтынский: контейнероориентированные контроллеры... Жесть
    [11:08:53] ns: Антон Кочнев: на апаче тоже будет, но сам понимаешь ощущения не те
    [11:08:54] ns: Руслан Левицкий: Ну тогда давай ссылку на доку
    [11:08:57] ns: Руслан Левицкий: Что ли...
    [11:09:06] ns: Артём Солтынский: На бою один фиг нет docker
    [11:09:06] ns: Руслан Левицкий: Лучше бы новостью
    [11:09:09] ns: Антон Кочнев: <a href="http://i.nodasoft.com/index.php/Vde#.D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_VDE_.D0.BD.D0.B0_docker">http://i.nodasoft.com/index.php/Vde#.D0.A3.D1.81.D1.82.D0.B0.D0.BD.D0.BE.D0.B2.D0.BA.D0.B0_VDE_.D0.BD.D0.B0_docker</a>
    [11:09:22] ns: Антон Кочнев: ну новость я чуть попзже хотел дать
    [11:09:32] ns: Антон Кочнев: когда мы переведем контейнеры на 5.5 в продакшене
    [11:09:55] ns: Артём Солтынский: а я бы дал ссылку на установщик... <a href="http://gitlab.nodasoft.com/docker/installer">http://gitlab.nodasoft.com/docker/installer</a>
    [11:10:39] ns: Руслан Левицкий: "Для применения новых прав необходимо перелогинится в системе"
    [11:10:41] ns: Руслан Левицкий: эх
    [11:10:50] ns: Антон Кочнев: ну да
    [11:10:55] ns: Антон Кочнев: либо запускать под sudo
    [11:11:18] ns: Руслан Левицкий: Он меня попросил пароль
    [11:11:24] ns: Руслан Левицкий: после этой команды wget -qO- https://get.docker.com/ | sh
    [11:11:31] ns: Руслан Левицкий: Чет подозрительно
    [11:11:34] ns: Антон Кочнев: ага
    [11:11:38] ns: Артём Солтынский: Антон, док про перелогин уже устарел в последнем докере
    [11:11:47] ns: Антон Кочнев: эта команда добавляет запись в репозиторий
    [11:11:53] ns: Антон Кочнев: и устанавливает пакет
    [11:12:10] ns: Антон Кочнев: Артем, а как теперь?
    [11:12:28] ns: Руслан Левицкий: 2x(facepalm)
    [11:13:04] ns: Руслан Левицкий: Чуваки, ну вы разберитесь а я пойду пока покурю.
    [11:14:27] ns: Артём Солтынский: он сам делает юзера, добавляет его в группу, вообщем после установщика - не надо никуда перелогиниваться. У меня заработало сразу
    [11:15:41] ns: Антон Кочнев: странно
    [11:15:45] ns: Антон Кочнев: ну ок )
    [11:15:53] ns: Антон Кочнев: в доке написано что нужно сделать
    [11:16:00] ns: Антон Кочнев: может у тебя уже была эта группа раньше
    [11:16:44] ns: Антон Кочнев: <a href="https://docs.docker.com/installation/ubuntulinux/#create-a-docker-group">https://docs.docker.com/installation/ubuntulinux/#create-a-docker-group</a>
    [11:18:07] ns: Руслан Левицкий: E: Не удалось найти пакет docker-engine
    [11:18:09] ns: Руслан Левицкий: :(
    [11:18:15] ns: Руслан Левицкий: Да что ж такое
    [11:18:16] ns: Антон Кочнев: это прокси
    [11:18:32] ns: Антон Кочнев: нужно вырубить его )
    [11:18:35] ns: Антон Кочнев: или порт сменить
    [11:18:40] ns: Руслан Левицкий: Мда...
    [11:18:55] ns: Рустам Ибрагимов: 3128
    [11:19:50] ns: Антон Кочнев: Рустам а файл какой?
    [11:19:56] ns: Рустам Ибрагимов: ща
    [11:19:57] ns: Антон Кочнев: добавлю в доку
    [11:21:41] ns: Рустам Ибрагимов: /etc/apt/apt.conf.d/01proxy
    у меня
    [11:21:43] ns: Рустам Ибрагимов: так
    [11:23:18] ns: Антон Кочнев: у меня нет этого файла, поэтому и работает нормально видимо )
    [11:33:10] ns: Максим Дьячков: про докер и вагрант
    [11:33:31] ns: Максим Дьячков: докер по словам Антона круче, поэтому новый фен-шуй - это миграция всех на докер
    [11:33:57] ns: Максим Дьячков: однако, так как на вагранте тоже ещё народ работает кое-гда :) была договорённость что изменения вносятся и в вагрант
    [11:34:05] ns: Максим Дьячков: чтобы он вот просто так не отвалился
    [11:34:34] ns: Максим Дьячков: Чем быстрее Антон всех перевезёт в докер, тем быстрее не нужно будет поддерживать вагрант
</cite>
<cite>
    [11:37:31] ns: Антон Кочнев: Макс это не феншуй
    [11:37:42] ns: Антон Кочнев: у нас настройкой рабочего места занимается каждый самостоятельно
    [11:37:57] ns: Антон Кочнев: я настроил себе, и разарботчики могут пользоваться моими наработками
    [11:38:14] ns: Антон Кочнев: по мере возможностей я помогаю
    [11:38:56] ns: Артём Солтынский: Антон, если ты настроил докер только для себя - нельзя создавать ситуаций, когда у других все отвалится и никогда не заработает)
    [11:39:10] ns: Антон Кочнев: отчего же?
    [11:39:17] ns: Антон Кочнев: я лишь иммитирую работу продакшена
    [11:39:24] ns: Антон Кочнев: на продакшене стоит nginx
    [11:39:27] ns: Антон Кочнев: с редиректами
    [11:39:36] ns: Максим Дьячков: погоди погоди
    [11:39:54] ns: Максим Дьячков: Антон, Артём сделал вде на вагранте, которое работало с полпинга
    [11:40:09] ns: Антон Кочнев: угу
    [11:40:46] ns: Антон Кочнев: а из за того что оно настроено не так как на продакшене у нас возникают разного рода ситуации
    [11:40:52] ns: Антон Кочнев: и непредвиденные ошибки
    [11:40:53] ns: Максим Дьячков: 5 сек
    [11:41:34] ns: Антон Кочнев: я стараюсь поддерживать свою vde в состоянии максимально приближенном к продакшену
    [11:41:56] ns: Артём Солтынский: Докер тоже имитация боя... Пока нет докера на бою - все локальные поделки - локальными и останутся.
    [11:42:18] ns: Артём Солтынский: Я не защищаю вагрант, не пропогандирую за докер. Я как раз за приближение окружений
    [11:42:18] ns: Антон Кочнев: ага
    [11:42:26] ns: Антон Кочнев: вообще согласен
    [11:42:50] ns: Артём Солтынский: в докере до сих пор апач.. что уж там говорить
    [11:43:56] ns: Максим Дьячков: [11:38:34] Антон Кочнев:116: у нас настройкой рабочего места занимается каждый самостоятельно
    это плохо
    [11:44:23] ns: Артём Солтынский: В вагранте была хотя бы попытка создать скрипты разворачивания окружения как локально, так и на бою. Скрипты одни и теже, но локально чуть больше - для dev-tools и некоторых конфигов... Так сделано на order-api, vinqu-routing и на front-end
    [11:45:35] ns: Максим Дьячков: Антон, так что, докер не в трендах, это ты только для себя типа сделал?
    [11:46:31] ns: Руслан Левицкий: Короче, ребут машины и vagrant destroy -f вроде помог...
    [11:46:40] ns: Антон Кочнев: Макс. ну пока докера не будет в продакшене, да для себя
    [11:46:41] ns: Руслан Левицкий: Сча узнаем окончательно
    [11:46:49] ns: Антон Кочнев: когда запилим на бою тогда обязаловка будет
    [11:54:51] ns: Антон Кочнев: в общем моя изначальная позия была такая, что я настраиваю себе vde на докер, и по мере возможности помагаю желающим.
    [11:54:57] ns: Антон Кочнев: с тех пор ничего не изменилось
    [11:55:10] ns: Максим Дьячков: нене
    [11:55:22] ns: Максим Дьячков: твоя позиция была - заменить вагрант докером
    [11:55:30] ns: Антон Кочнев: д тех пор пока докер не будет в продакшене
    [11:55:51] ns: Антон Кочнев: вот тогда конечно будет и феншуй и новый тренд
    [11:56:11] ns: Антон Кочнев: допустим в ближайший меся у нас на продакшене будут контейнеры с 5.5
    [11:56:30] ns: Руслан Левицкий: Короче, помогло
    [11:56:33] ns: Антон Кочнев: у всех у кого стоит убунта 12 все слетит нафиг
    [11:56:38] ns: Антон Кочнев: им придется ставить vde
    [11:57:48] ns: Антон Кочнев: Руслан, так что в итоге было?
    [11:57:54] ns: Артём Солтынский: а у кого 14-ая, ничего не слетит даже без vde, а у кого настроено vde-14 тоже ничего не слетит..
    [11:58:04] ns: Антон Кочнев: угу
    [11:58:42] ns: Антон Кочнев: собственно ничего не мешает совмещать контейнеры
    [11:58:50] ns: Антон Кочнев: можно одновременно и вагрант и докер юзать
    [11:59:45] ns: Руслан Левицкий: Хз
    [11:59:51] ns: Руслан Левицкий: Дестрой и ребут помог
    [11:59:58] ns: Антон Кочнев: странно конечно
    ***
    [22:00:41] ns: Артём Солтынский: для докероюзеров. Сегодня залил небольшие изменения в конфиги. Но они походу требуют последнего докера и docker-compose. Т.е если нужен будет rebuild, то нужно обновиться
    Нужен докер минимум 1.7.1 ( docker -v )
    <code>
        curl -sSL https://get.docker.com/ | sh<br>
        curl -L https://github.com/docker/compose/releases/download/1.4.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
    </code>
    [22:15:31] ns: Артём Солтынский: после аппа нужно перезапустить докер-демон
    <code>sudo service docker restart</code>
    или как-то там через systemd для 15.04
    [22:15:45] ns: Артём Солтынский: ну или ребутнуться)
    ***
    [16:00:03] ns: Антон Кочнев: Артем еще не опытный не знает, что у нас люди не думают, а суют в консоль все что видят в чатике. Поэтому правильно будет так:
    <code>
        curl -sSL https://get.docker.com/ | sh<br>
        sudo bash -c "curl -L https://github.com/docker/compose/releases/download/1.4.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose"
    </code>
</cite>

Команды докера
<code>
    cd /opt/projects/abcp
    docker-compose up -d web # запустить контейнер с abcp php5.3
    docker-compose up -d web14 # запустить контейнер с abcp php5.5
    docker-compose stop # остановить все контейнеры abcp
    docker stop abcp.web # остановить контейнер abcp.web
    docker ps # просмотреть текущие запущенные контейнеры
    docker-compose run cmd php www.abcp/ourtest.abcp.ru/groall.tests/price.generation.php # запуск php скрипта
</code>

Когда локально у вирта каша, надо обновить вирт.хосты
/opt/projects/abcp/docker тут лежит readme с командой обновления вирт. хостов
<code>docker-compose run --rm cmd php www.scripts/generate.server.config.php -docker
    docker-compose restart</code>


<cite>
    Julia Gromova, [01.12.15 13:09]
    и где-то тут делает пдф /opt/projects/abcp/framework/lib/xls/xls.to.pdf/get.pdf.php
    Александр Громов, [01.12.15 13:09]
    эта папка не пробрасывается из докера
    Александр Громов, [01.12.15 13:10]
    - /opt/tmp.abcp/:/opt/tmp.abcp
    Александр Громов, [01.12.15 13:10]
    добавь ниже docker-compose.yml:56
    Александр Громов, [01.12.15 13:10]
    и сделай
    docker-compose stop
    docker-compose rm
    docker-compose up -d web
</cite>


Fatal error: Maximum function nesting level of '1000' reached, aborting! in /usr/local/vendor/smarty/smarty/libs/sysplugins/smarty_internal_templatebase.php on line 304
<code>docker-compose stop
    docker-compose rm
    docker-compose up -d (docker-compose up -d web)</code>
</body>
</html>